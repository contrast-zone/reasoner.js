<!DOCTYPE html>
<!--?xml version="1.0"?-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>rewriter.js playground</title>
<link rel="icon" type="image/png" href="">

<script src="../src/s-expr.js"></script>
<script src="../src/ruler.js"></script>
<script src="../src/rewriter.js"></script>
<script src="edit.js"></script>

<script id="test0"  type="text/plain">
(
    RULE
    (
        READ
        (WRITE (isBeingEducated <person>))
        (RULE (READ <person>) (WRITE Jane))
    )
    (
        READ
        
        (
            RULE
            (READ (isBeingEducated Jane))
            (WRITE (attendsSchool Jane) (attendsCollege Jane))
        )
        (
            RULE
            (READ (attendsSchool Jane))
            (WRITE (buildsARobot Jane))
        )
        (
            RULE
            (READ (attendsCollege Jane))
            (WRITE (buildsARobot Jane))
        )
        
        (
            RULE
            (READ (buildsARobot Jane))
            (WRITE (mastersSoftware Jane))
        )
        (
            RULE
            (READ (buildsARobot Jane))
            (WRITE (mastersHardware Jane))
        )
        (
            RULE
            (READ (mastersSoftware Jane) (mastersHardware Jane))
            (WRITE (isAComputerExpert Jane))
        )
        
    )
    (
        WRITE
        (RULE (READ Jane) (WRITE <person>))
        (READ (isAComputerExpert <person>))
    )
)
</script>
<script id="test0-input"  type="text/plain">
(isBeingEducated Jane)
</script>
<script id="randomthoughts" type="text/plain">
(
    (
        ITYPE
        (
            (
                ITYPE
                (
                    (
                        ITYPE
                    )
                    (
                        OTYPE
                    )
                )
            )
            (
                OTYPE
                (
                    (
                        OTYPE
                    )
                    (
                        ITYPE
                    )
                )
            )
        )
    )
    (
        OTYPE
        (
            (
                OTYPE
                (
                    (
                        OTYPE
                    )
                    (
                        ITYPE
                    )
                )
            )
            (
                ITYPE
                (
                    (
                        ITYPE
                    )
                    (
                        OTYPE
                    )
                )
            )
        )
    )
)
</script>

<script id="example000" type="text/plain">
/*
    simple translation example
    
     input: `(1 (1 (...) 1) 1)`
    output: `(2 (2 (...) 2) 2)`
*/

(
    REWRITE
    (
        ITYPE
        (REWRITE (ITYPE     ) (OTYPE <x1>      ))
        (REWRITE (ITYPE <x1>) (OTYPE (1)       ))
        (REWRITE (ITYPE <x1>) (OTYPE (1 <x1> 1)))
    )
    (
        IOCHAIN
        (REWRITE (ITYPE 1) (OTYPE 2))
    )
    (
        OTYPE
        (REWRITE (OTYPE (2 <x2> 2)) (ITYPE <x2>))
        (REWRITE (OTYPE (2)       ) (ITYPE <x2>))
        (REWRITE (OTYPE <x2>      ) (ITYPE     ))
    )
)
</script>

<script id="example000-input" type="text/plain">
(1 (1 (1 (1 (1) 1) 1) 1) 1)
</script>

<script id="example00" type="text/plain">
(
    REWRITE
    (
        ITYPE
        (REWRITE (ITYPE      ) (OTYPE (input (hearing (x z)))))
        (REWRITE (ITYPE     (x y)) (OTYPE voice))
        (REWRITE (ITYPE     z) (OTYPE y))
        (REWRITE (ITYPE voice) (OTYPE barks meows            ))
    )
    (
        IOCHAIN
        (REWRITE (ITYPE (input (hearing meows))) (OTYPE (output (being cat))))
        (REWRITE (ITYPE (input (hearing barks))) (OTYPE (output (being dog))))
    )
    (
        OTYPE
        (REWRITE (OTYPE                 cat dog) (ITYPE living))
        (REWRITE (OTYPE (output (being living))) (ITYPE       ))
    )
)
</script>
<script id="example00-input" type="text/plain">
(voice)
</script>

<script id="example000" type="text/plain">
(
    REWRITE
    (
        ITYPE
        (REWRITE (ITYPE      ) (OTYPE (input (hearing voice))))
        (REWRITE (ITYPE voice) (OTYPE barks meows            ))
    )
    (
        IOCHAIN
        (REWRITE (ITYPE (input (hearing meows))) (OTYPE (output (being cat))))
        (REWRITE (ITYPE (input (hearing barks))) (OTYPE (output (being dog))))
    )
    (
        OTYPE
        (REWRITE (OTYPE                 cat dog) (ITYPE living))
        (REWRITE (OTYPE (output (being living))) (ITYPE       ))
    )
)
</script>

<script id="example0" type="text/plain">
(
    REWRITE
    (
        ITYPE
        (RULE (READ) (WRITE (hearing (<voice>))))
        
        (RULE (READ (<voice>)) (WRITE (barks)            ))
        (RULE (READ (<voice>)) (WRITE (meows)            ))
    )
    (
        IOCHAIN
        (RULE (READ (hearing (meows))) (WRITE (being (cat))))
        (RULE (READ (hearing (barks))) (WRITE (being (dog))))
    )
    (
        OTYPE
        (RULE (READ (cat)           ) (WRITE (living)))
        (RULE (READ (dog)           ) (WRITE (living)))
        
        (RULE (READ (being (living))) (WRITE))
    )
)
</script>

<script id="example0-input" type="text/plain">
(hearing (meows))
</script>

<script id="example1-3" type="text/plain">
/*
    simple input/output example
    
     input: `(hello machine)`
    output: `(hello world)`
*/

(
    REWRITE
    (
        ITYPE
        (WRITE (hello machine))
    )
    (
        IOCHAIN
        (RULE (READ (hello machine)) (WRITE (hello world)))
    )
    (
        OTYPE
        (READ (hello world))
    )
)
</script>

<script id="example1-3-input" type="text/plain">
(hello machine)
</script>

<script id="example2a" type="text/plain">
/*
    conversation example
    
     input: `(say "hi computer"/"look, a flower"/"bye computer")`
    output: `(hear "hello entity"/"awesome"/"goodbye entity")`
*/

(
    REWRITE
    (
        ITYPE
        (WRITE (say "hi computer"))
        (WRITE (say "look, a flower"))
        (WRITE (say "bye computer"))
    )
    (
        IOCHAIN
        (RULE (READ (say "hi computer")   ) (WRITE (hear "hello entity")  ))
        (RULE (READ (say "look, a flower")) (WRITE (hear "awesome")       ))
        (RULE (READ (say "bye computer")  ) (WRITE (hear "goodbye entity")))
    )
    (
        OTYPE
        (READ (hear "hello entity"))
        (READ (hear "awesome"))
        (READ (hear "goodbye entity"))
    )
)
</script>

<script id="example2a-input" type="text/plain">
(say "hi computer")
</script>

<script id="example3ze" type="text/plain">
/*
    gravity decision
    
     input: `(hasMass Sun/Earth/Moon)`
    output: `(hasGravity Sun/Earth/Moon)`
*/

(
    REWRITE
    (
        ITYPE
        (WRITE (hasMass <object>))
        (RULE (READ <object>) (WRITE Sun  ))
        (RULE (READ <object>) (WRITE Earth))
        (RULE (READ <object>) (WRITE Moon ))
    )
    (
        IOCHAIN
        (RULE (READ (hasMass Sun)  ) (WRITE (hasGravity Sun)  ))
        (RULE (READ (hasMass Earth)) (WRITE (hasGravity Earth)))
        (RULE (READ (hasMass Moon) ) (WRITE (hasGravity Moon) ))
    )
    (
        OTYPE
        (RULE (READ Sun  ) (WRITE <object>))
        (RULE (READ Earth) (WRITE <object>))
        (RULE (READ Moon ) (WRITE <object>))
        (READ (hasGravity <object>))
    )
)
</script>

<script id="example3ze-input" type="text/plain">
(hasMass Earth)
</script>

<script id="example3ae" type="text/plain">
/*
    job title decision
    
     input: `(isDoing Jane/John (driving rocket)/(healing people))`
    output: `(isTitled Jane/John astronaut/doctor)`
*/

(
    REWRITE
    (
        ITYPE
        (WRITE (isDoing <person> <job>))
        (RULE (READ <person>) (WRITE Jane            ))
        (RULE (READ <person>) (WRITE John            ))
        (RULE (READ <job>   ) (WRITE (driving rocket)))
        (RULE (READ <job>   ) (WRITE (healing people)))
    )
    (
        IOCHAIN
        
        // Jane
        (
            RULE
            (READ (isDoing Jane (driving rocket)))
            (WRITE (isTitled Jane astronaut))
        )
        (
            RULE
            (READ (isDoing Jane (healing people)))
            (WRITE (isTitled Jane doctor))
        )
        
        // John
        (
            RULE
            (READ (isDoing John (driving rocket)))
            (WRITE (isTitled John astronaut))
        )
        (
            RULE
            (READ (isDoing John (healing people)))
            (WRITE (isTitled John doctor))
        )
    )
    (
        OTYPE
        (RULE (READ astronaut) (WRITE <title> ))
        (RULE (READ doctor   ) (WRITE <title> ))
        (RULE (READ Jane     ) (WRITE <person>))
        (RULE (READ John     ) (WRITE <person>))
        (READ (isTitled <person> <title>))
    )
)
</script>

<script id="example3ae-input" type="text/plain">
(isDoing Jane (driving rocket))
</script>

<script id="example3be" type="text/plain">
/*
    student decision
    
     input: `(isBeingEducated Jane/John)`
    output: `(isAStudent Jane/John)`
*/

(
    REWRITE
    (
        ITYPE
        (WRITE (isBeingEducated <person>))
        (RULE (READ <person>) (WRITE Jane))
        (RULE (READ <person>) (WRITE John))
    )
    (
        IOCHAIN
        
        // Jane
        (
            RULE
            (READ (isBeingEducated Jane))
            (WRITE (attendsSchool Jane) (attendsCollege Jane))
        )
        (
            RULE
            (READ (attendsSchool Jane))
            (WRITE (isAStudent Jane))
        )
        (
            RULE
            (READ (attendsCollege Jane))
            (WRITE (isAStudent Jane))
        )
        
        // John
        (
            RULE
            (READ (isBeingEducated John))
            (WRITE (attendsSchool John) (attendsCollege John))
        )
        (
            RULE
            (READ (attendsSchool John))
            (WRITE (isAStudent John))
        )
        (
            RULE
            (READ (attendsCollege John))
            (WRITE (isAStudent John))
        )
    )
    (
        OTYPE
        (RULE (READ Jane) (WRITE <person>))
        (RULE (READ John) (WRITE <person>))
        (READ (isAStudent <person>))
    )
)
</script>

<script id="example3be-input" type="text/plain">
(isBeingEducated Jane)
</script>

<script id="example3ce" type="text/plain">
/*
    computer expert decision
    
     input: `(buildsARobot Jane/John)`
    output: `(isAComputerExpert Jane/john)`
*/

(
    REWRITE
    (
        ITYPE
        (WRITE (buildsARobot <person>))
        (RULE (READ <person>) (WRITE Jane))
        (RULE (READ <person>) (WRITE John))
    )
    (
        IOCHAIN
        
        // Jane
        (
            RULE
            (READ (buildsARobot Jane))
            (WRITE (mastersSoftware Jane))
        )
        (
            RULE
            (READ (buildsARobot Jane))
            (WRITE (mastersHardware Jane))
        )
        (
            RULE
            (READ (mastersSoftware Jane) (mastersHardware Jane))
            (WRITE (isAComputerExpert Jane))
        )
        
        // John
        (
            RULE
            (READ (buildsARobot John))
            (WRITE (mastersSoftware John))
        )
        (
            RULE
            (READ (buildsARobot John))
            (WRITE (mastersHardware John))
        )
        (
            RULE
            (READ (mastersSoftware John) (mastersHardware John))
            (WRITE (isAComputerExpert John))
        )
    )
    (
        OTYPE
        (RULE (READ Jane) (WRITE <person>))
        (RULE (READ John) (WRITE <person>))
        (READ (isAComputerExpert <person>))
    )
)
</script>

<script id="example3ce-input" type="text/plain">
(buildsARobot Jane)
</script>

<script id="example1-1" type="text/plain">
/*
    hello world example
    
     input: `(hello machine)`
    output: `(hello world)`
*/

(RULE (READ (hello machine)) (WRITE (hello world)))
</script>

<script id="example1-1-input" type="text/plain">
(hello machine)
</script>

<script id="example1-2" type="text/plain">
/*
    hello entity example
    
     input: `(greet X)`
    output: `(hello X)`
*/

(
    MATCH
    (VAR <X>)
    (RULE (READ (greet <X>)) (WRITE (hello <X>)))
)
</script>

<script id="example1-2-input" type="text/plain">
(greet human)
</script>

<script id="example-2-1" type="text/plain">
/*
    toy making decision
    
     input: `(isGood (girl)/(boy))`
    output: `(makeToy (doll)/(car))`
*/

(
    REWRITE
    (
        ITYPE
        
        (RULE (READ) (WRITE (isGood (child))))
        
        (RULE (READ (child)) (WRITE (girl)))
        (RULE (READ (child)) (WRITE (boy) ))
    )
    (
        IOCHAIN
        (RULE (READ (isGood (girl))) (WRITE (makeToy (doll))))
        (RULE (READ (isGood (boy)) ) (WRITE (makeToy (car)) ))
    )
    (
        OTYPE
        
        (RULE (READ (doll)) (WRITE (toy)))
        (RULE (READ (car) ) (WRITE (toy)))
        
        (RULE (READ (makeToy (toy))) (WRITE))
    )
)
</script>

<script id="example-2-1-input" type="text/plain">
(isGood (girl))
</script>

<script id="example-2-2" type="text/plain">
/*
    shadows decision
    
     input: `(sunIs (rising)/(falling))`
    output: `(shadowsDo (expand)/(shrink))`
*/

(
    REWRITE
    (
        ITYPE
        
        (RULE (READ) (WRITE (sunIs (advancing))))
        
        (RULE (READ (advancing)) (WRITE (rising) ))
        (RULE (READ (advancing)) (WRITE (falling)))
    )
    (
        IOCHAIN

        (RULE (READ (sunIs (rising)) ) (WRITE (itIs morning)  ))
        (RULE (READ (sunIs (falling))) (WRITE (itIs afternoon)))

        (RULE (READ (itIs morning)  ) (WRITE (shadowsLean west)))
        (RULE (READ (itIs afternoon)) (WRITE (shadowsLean east)))

        (RULE (READ (shadowsLean west)) (WRITE (shadowsDo (shrink))))
        (RULE (READ (shadowsLean east)) (WRITE (shadowsDo (expand))))
    )
    (
        OTYPE
        
        (RULE (READ (shrink)) (WRITE (resize)))
        (RULE (READ (expand)) (WRITE (resize)))
        
        (RULE (READ (shadowsDo (resize))) (WRITE))
    )
)
</script>

<script id="example-2-2-input" type="text/plain">
(sunIs (rising))
</script>

<script id="example-3-1" type="text/plain">
/*
    weighting decision
    
     input: `(orbitsAround (Sun)/(Earth)/(Moon) (Sun)/(Earth)/(Moon))`
    output: `(weigthtsMoreThan (Sun)/(Earth)/(Moon) (Sun)/(Earth)/(Moon))`
*/

(
    REWRITE
    (
        ITYPE
        
        (RULE (READ) (WRITE (orbitsAround (object) (object))))
        
        (RULE (READ (object)) (WRITE (Sun)  ))
        (RULE (READ (object)) (WRITE (Earth)))
        (RULE (READ (object)) (WRITE (Moon) ))
    )
    (
        IOCHAIN
        (
            MATCH
            (VAR <O1> <O2>)
            (
                RULE
                (READ (orbitsAround <O1> <O2>))
                (WRITE (weightsMoreThan <O2> <O1>))
            )
        )
    )
    (
        OTYPE
        
        (RULE (READ (Sun)  ) (WRITE (object)))
        (RULE (READ (Earth)) (WRITE (object)))
        (RULE (READ (Moon) ) (WRITE (object)))
        
        (RULE (READ (weightsMoreThan (object) (object))) (WRITE))
    )
)
</script>

<script id="example-3-1-input" type="text/plain">
(orbitsAround (Earth) (Sun))
</script>

<script id="example-3-2" type="text/plain">
/*
    job title decision
    
     input: `(isDoing (Jane)/(John) (driving rocket)/(healing people))`
    output: `(isTitled (Jane)/(John) (astronaut)/(doctor))`
*/

(
    REWRITE
    (
        ITYPE
        
        (RULE (READ) (WRITE (isDoing (person) (job))))
        
        (RULE (READ (person)) (WRITE (Jane)          ))
        (RULE (READ (person)) (WRITE (John)          ))
        (RULE (READ (job)   ) (WRITE (driving rocket)))
        (RULE (READ (job)   ) (WRITE (healing people)))
    )
    (
        IOCHAIN
        (
            MATCH
            (VAR <P>)
            (
                RULE
                (READ (isDoing <P> (driving rocket)))
                (WRITE (isTitled <P> (astronaut)))
            )
        )
        (
            MATCH
            (VAR <P>)
            (
                RULE
                (READ (isDoing <P> (healing people)))
                (WRITE (isTitled <P> (doctor)))
            )
        )
    )
    (
        OTYPE
        
        (RULE (READ (astronaut)) (WRITE (title) ))
        (RULE (READ (doctor)   ) (WRITE (title) ))
        (RULE (READ (Jane)     ) (WRITE (person)))
        (RULE (READ (John)     ) (WRITE (person)))
        
        (RULE (READ (isTitled (person) (title))) (WRITE))
    )
)
</script>

<script id="example-3-2-input" type="text/plain">
(isDoing (Jane) (driving rocket))
</script>

<script id="example-4-1" type="text/plain">
/*
    student decision
    
     input: `(isBeingEducated (Jane)/(John))`
    output: `(isAStudent (Jane)/(John))`
*/

(
    REWRITE
    (
        ITYPE
        
        (RULE (READ) (WRITE (isBeingEducated (person))))
        
        (RULE (READ (person)) (WRITE (Jane)))
        (RULE (READ (person)) (WRITE (John)))
    )
    (
        IOCHAIN
        (
            MATCH
            (VAR <a> <b> <c>)
            (
                RULE
                (
                    READ
                    (RULE (READ (<a>) (WRITE (<c>))))
                )
                (
                    WRITE
                    (
                        RULE
                        (
                            READ
                            (RULE (READ (<b>) (WRITE (<c>))))
                        )
                        (
                            WRITE
                            (RULE (READ (or <a> <b>)) (WRITE <c>))
                        )
                    )
                )
            )
        )
        (
            MATCH
            (VAR <P>)
            (
                RULE
                (READ (isBeingEducated <P>))
                (WRITE (or (attendsSchool <P>) (attendsCollege <P>)))
            )
        )
        (
            MATCH
            (VAR <P>)
            (
                RULE
                (READ (attendsSchool <P>))
                (WRITE (isAStudent <P>))
            )
        )
        (
            MATCH
            (VAR <P>)
            (
                RULE
                (READ (attendsCollege <P>))
                (WRITE (isAStudent <P>))
            )
        )
    )
    (
        OTYPE
        
        (RULE (READ (Jane)) (WRITE (person)))
        (RULE (READ (John)) (WRITE (person)))
        
        (RULE (READ (isAStudent (person))) (WRITE))
    )
)
</script>

<script id="example-4-1-input" type="text/plain">
(isBeingEducated (Jane))
</script>

<script id="example-4-2" type="text/plain">
/*
    computer expert decision
    
     input: `(buildsARobot (Jane)/(John))`
    output: `(isAComputerExpert (Jane)/(john))`
*/

(
    REWRITE
    (
        ITYPE
        
        (RULE (READ) (WRITE (buildsARobot (person))))
        
        (RULE (READ (person)) (WRITE (Jane)))
        (RULE (READ (person)) (WRITE (John)))
    )
    (
        IOCHAIN
        (
            MATCH
            (VAR <a> <b> <c>)
            (
                RULE
                (
                    READ
                    (RULE (READ (<a>) (WRITE (<b>))))
                )
                (
                    WRITE
                    (
                        RULE
                        (
                            READ
                            (RULE (READ (<a>) (WRITE (<c>))))
                        )
                        (
                            WRITE
                            (RULE (READ (<a>)) (WRITE (and <b> <c>)))
                        )
                    )
                )
            )
        )
        (
            MATCH
            (VAR <P>)
            (
                RULE
                (READ (buildsARobot <P>))
                (WRITE (mastersSoftware <P>))
            )
        )
        (
            MATCH
            (VAR <P>)
            (
                RULE
                (READ (buildsARobot <P>))
                (WRITE (mastersHardware <P>))
            )
        )
        (
            MATCH
            (VAR <P>)
            (
                RULE
                (READ (and (mastersSoftware <P>) (mastersHardware <P>)))
                (WRITE (isAComputerExpert <P>))
            )
        )
    )
    (
        OTYPE
        
        (RULE (READ (Jane)) (WRITE (person)))
        (RULE (READ (John)) (WRITE (person)))
        
        (RULE (READ (isAComputerExpert (person))) (WRITE))
    )
)
</script>

<script id="example-4-2-input" type="text/plain">
(buildsARobot (Jane))
</script>

<script id="example-5-1" type="text/plain">
(
    REWRITE
    (
        MATCH
        (VAR <x>)
        (RULE (READ (eq <x> <x>)) (WRITE (true)))
    )
    (
        MATCH
        (VAR <x> <y>)
        (RULE (READ (eq <x> <y>)) (WRITE (false)))
    )
)
</script>

<script id="example-5-1-input" type="text/plain">
(eq (x + 1) (x + 1))
</script>

<script id="example-5-2" type="text/plain">
(
    REWRITE
    (
        MATCH
        (VAR <x> <y>)
        (RULE (READ (if true then <x> else <y>) ) (WRITE (<x>)))
    )
    (
        MATCH
        (VAR <x> <y>)
        (RULE (READ (if false then <x> else <y>)) (WRITE (<y>)))
    )
)
</script>

<script id="example-5-2-input" type="text/plain">
(if true then (Yes, it's true.) else (No, it's false.))
</script>

<script id="example-5-3" type="text/plain">
(
    REWRITE
    
    // AND
    (RULE (READ (and true true ) ) (WRITE (true) ))
    (RULE (READ (and true false) ) (WRITE (false)))
    (RULE (READ (and false true) ) (WRITE (false)))
    (RULE (READ (and false false)) (WRITE (false)))
    
    // OR
    (RULE (READ (or true true)  ) (WRITE (true) ))
    (RULE (READ (or true false) ) (WRITE (true) ))
    (RULE (READ (or false true) ) (WRITE (true) ))
    (RULE (READ (or false false)) (WRITE (false)))
    
    // NOT
    (RULE (READ (not true) ) (WRITE (false)))
    (RULE (READ (not false)) (WRITE (true) ))
)
</script>

<script id="example-5-3-input" type="text/plain">
(not (or (and false true) false))
</script>

<script id="example-7-1" type="text/plain">
/*
    combinatory logic
    
     input: combinatory logic program and parameters
    output: computed value
*/

(
    REWRITE
    (
        MATCH
        (VAR <x>)
        (RULE (READ (I <x>)) (WRITE <x>))
    )
    (
        MATCH
        (VAR <x> <y>)
        (RULE (READ ((K <x>) <y>)) (WRITE <x>))
    )
    (
        MATCH
        (VAR <x> <y> <z>)
        (RULE (READ (((S <x>) <y>) <z>)) (WRITE ((<x> <z>) (<y> <z>))))
    )
)
</script>

<script id="example-7-1-input" type="text/plain">
((((S (K (S I))) ((S (K K)) I)) x) y)
</script>

<script id="example-7-2" type="text/plain">
/*
    lambda calculus to combinatory logic compiler
    
     input: lambda expression
    output: combinatory logic program and parameters
*/

(
    REWRITE
    (
        MATCH
        (VAR <x> <M> <N>)
        (
            RULE
            (READ (lambda <x> (<M> <N>)))
            (WRITE (S (lambda <x> <M>) (lambda <x> <N>)))
        )
    )
    (
        MATCH
        (VAR <x>)
        (
            RULE
            (READ (lambda <x> <x>))
            (WRITE I)
        )
    )
    (
        MATCH
        (VAR <x> <M>)
        (
            RULE
            (READ (lambda <x> <M>))
            (WRITE (K <M>))
        )
    )
)
</script>

<script id="example-7-2-input" type="text/plain">
(lambda x (lambda y (y x)))
</script>

<script id="example7" type="text/plain">
/*
    untyped lambda calculus example
    
     input: lambda expression
    output: evaluated lambda expression
*/

(
    REWRITE
    (
        ITYPE
        
        // syntax of lambda calculus
        (REWRITE (ITYPE           ) (OTYPE <abstract>                          ))
        (REWRITE (ITYPE <abstract>) (OTYPE (lmbd <variable> <abstract>) <apply>))
        (REWRITE (ITYPE    <apply>) (OTYPE (appl <apply> <primary>) <primary>  ))
        (REWRITE (ITYPE  <primary>) (OTYPE (<primary>) <variable> <abstract>   ))
        (REWRITE (ITYPE <variable>) (OTYPE a b c d e f                         ))
    )
    (
        IOCHAIN
        
        // alpha conversion
        (
            MATCH
            (
                VAR
                (ID <X> <variable>)
                (ID <Y> <variable>)
                (ID <M> <abstract>)
            )
            (
                REWRITE
                (
                    ITYPE
                    (lmbd <X> <M>)
                )
                (
                    OTYPE
                    (<aconv> <Y> <M>)
                    (REWRITE (ITYPE <X>) (OTYPE <Y>))
                )
            )
        )
        
        // beta reduction
        (
            MATCH
            (
                VAR
                (ID <X> <variable>)
                (ID <M> <abstract>)
                (ID <N> <abstract>)
            )
            (
                REWRITE
                (
                    ITYPE
                    (appl (<aconv> <X> <M>) <N>)
                )
                (
                    OTYPE
                    <M>
                    (REWRITE (ITYPE <X>) (OTYPE <N>))
                )
            )
        )
    )
    (
        OTYPE
        
        <abstraction>
    )
)
</script>

<script id="example7-input" type="text/plain">
(appl (lmbd a (lmbd b a)) c)
</script>

<script id="example8" type="text/plain">
/*
    entscheidungsproblem solution for propositional logic
    
    input: a theorem
    output: the same input theorem if the input is successful
*/

(
    REWRITE
    (
        ITYPE

        /*
            [true intro]
               A     ~ A
            ------- ------
              true   true
        */
        (
            MATCH
            (VAR (ID <A> logic))
            (REWRITE (ITYPE <A>    ) (OTYPE true))
            (REWRITE (ITYPE (~ <A>)) (OTYPE true))
        )
        
        /*
            [true elim]
              A true
            ---------
               <A>
        */
        (
            MATCH
            (VAR (ID <A> logic))
            (REWRITE (ITYPE <A> true) (OTYPE <A>))
        )
        
        /*
            [false intro]
                 A
            ----------
             A, false
        */
        (
            MATCH
            (VAR (ID <A> logic))
            (REWRITE (ITYPE <A>) (OTYPE <A> false))
        )
        
        /*
            [false elim]
             false   false
            ------- -------
               A      ~ A
        */
        (
            MATCH
            (VAR (ID <A>))
            (REWRITE (ITYPE false) (OTYPE <A>    ))
            (REWRITE (ITYPE false) (OTYPE (~ <A>)))
        )
        
        /*        
            [id intro]
             A |- true
            -----------
                 A
        */
        (
            MATCH
            (VAR (ID <A> logic))
            (REWRITE (ITYPE (REWRITE (ITYPE <A>) (OTYPE true))) (OTYPE <A>))
        )

        /*        
            [id elim]
             true |- A
            -----------
                 A
        */
        (
            MATCH
            (VAR (ID <A> logic))
            (REWRITE (ITYPE (REWRITE (ITYPE true) (OTYPE <A>))) (OTYPE <A>))
        )

        /*
            [neg intro]
             A |- false
            ------------
                ~ A
        */
        (
            MATCH
            (VAR (ID <A> logic))
            (REWRITE (ITYPE (REWRITE (ITYPE <A>) (OTYPE false))) (OTYPE (not <A>)))
        )

        /*
            [neg elim]
             (~ A) |- false
            ----------------
                   A
        */
        (
            MATCH
            (VAR (ID <A> logic))
            (REWRITE (ITYPE (REWRITE (ITYPE (not <A>)) (OTYPE false))) (OTYPE <A>))
        )
        
        /*
            [and intro]
               A, B
            ----------
              A /\ B
        */
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (ITYPE <A> <B>) (OTYPE (and <A> <B>)))
        )

        /*
            [and elim]
             A /\ B   A /\ B
            -------- --------
                A       B
        */
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (ITYPE (and <A> <B>)) (OTYPE <A>))
            (REWRITE (ITYPE (and <A> <B>)) (OTYPE <B>))
        )

        /*
            [or intro]
                A       B
            -------- --------
             A \/ B   A \/ B
        */
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (ITYPE <A>) (OTYPE (or <A> <B>)))
            (REWRITE (ITYPE <B>) (OTYPE (or <A> <B>)))
        )

        /*
            [or elim]
              A \/ B
            ----------
               A, B
        */
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (ITYPE (or <A> <B>)) (OTYPE <A> <B>))
        )
        
        /*
            [impl intro]
             ((A |- B), A) |- B
            --------------------
                   A -> B
        */
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (ITYPE (REWRITE (ITYPE (REWRITE (ITYPE <A>) (OTYPE <B>)) <A>) (OTYPE <B>))) (OTYPE (impl <A> <B>)))
        )
        
        /*
            [impl elim]
             A -> B, A
            -----------
                 B
        */
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (ITYPE (impl <A> <B>) <A>) (OTYPE <B>))
        )
        
        /*
            [eq intro]
             A |- B, B |- A
            ----------------
                A <-> B
        */
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (ITYPE (REWRITE (ITYPE <A>) (OTYPE <B>)) (REWRITE (ITYPE <B>) (OTYPE <A>))) (OTYPE (eq <A> <B>)))
        )

        /*
            [eq elim]
             A <-> B    A <-> B
            ---------  ---------
              A |- B    B |- A
        */
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (ITYPE (eq <A> <B>)) (OTYPE (REWRITE (ITYPE <A>) (OTYPE <B>))))
            (REWRITE (ITYPE (eq <A> <B>)) (OTYPE (REWRITE (ITYPE <B>) (OTYPE <A>))))
        )
        
        // seed
        (REWRITE (ITYPE) (OTYPE true))
    )
    (
        IOCHAIN
    )
    (
        OTYPE
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (OTYPE (eq <A> <B>)) (ITYPE logic))
        )
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (OTYPE (impl <A> <B>)) (ITYPE logic))
        )
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (OTYPE (or <A> <B>)) (ITYPE logic))
        )
        (
            MATCH
            (VAR (ID <A> logic) (ID <B> logic))
            (REWRITE (OTYPE (and <A> <B>)) (ITYPE logic))
        )
        (
            MATCH
            (VAR (ID <A> logic))
            (REWRITE (OTYPE (not <A>)) (ITYPE logic))
        )
        (REWRITE (OTYPE false) (ITYPE logic))
        (REWRITE (OTYPE  true) (ITYPE logic))
        (REWRITE (OTYPE logic) (ITYPE      ))
    )
)
</script>

<script id="example8-input" type="text/plain">
(eq (and A B) (not (or (not A) (not B))))
</script>

<script id="exmpl-binadd" type="text/plain">
/*
    binary number addition
*/

(
    (
        REWRITE
        
        // both numbers single digits
        (              (REWRITE (ITYPE add       0       0) (OTYPE                       0)))
        (              (REWRITE (ITYPE add       0       1) (OTYPE                       1)))
        (              (REWRITE (ITYPE add       1       0) (OTYPE                       1)))
        (              (REWRITE (ITYPE add       1       1) (OTYPE                     1 0)))
        
        // first number multiple digits, second number single digit
        (    (VAR <a>) (REWRITE (ITYPE add (<a> 0)       0) (OTYPE                   <a> 0)))
        (    (VAR <a>) (REWRITE (ITYPE add (<a> 0)       1) (OTYPE                   <a> 1)))
        (    (VAR <a>) (REWRITE (ITYPE add (<a> 1)       0) (OTYPE                   <a> 1)))
        (    (VAR <a>) (REWRITE (ITYPE add (<a> 1)       1) (OTYPE           (add 1 <a>) 0)))
        
        // first number single digit, second number multiple digits
        (    (VAR <b>) (REWRITE (ITYPE add       0 (<b> 0)) (OTYPE                   <b> 0)))
        (    (VAR <b>) (REWRITE (ITYPE add       0 (<b> 1)) (OTYPE                   <b> 1)))
        (    (VAR <b>) (REWRITE (ITYPE add       1 (<b> 0)) (OTYPE                   <b> 1)))
        (    (VAR <b>) (REWRITE (ITYPE add       1 (<b> 1)) (OTYPE           (add 1 <b>) 0)))
        
        // both numbers multiple digits
        ((VAR <a> <b>) (REWRITE (ITYPE add (<a> 0) (<b> 0)) (OTYPE         (add <a> <b>) 0)))
        ((VAR <a> <b>) (REWRITE (ITYPE add (<a> 0) (<b> 1)) (OTYPE         (add <a> <b>) 1)))
        ((VAR <a> <b>) (REWRITE (ITYPE add (<a> 1) (<b> 0)) (OTYPE         (add <a> <b>) 1)))
        ((VAR <a> <b>) (REWRITE (ITYPE add (<a> 1) (<b> 1)) (OTYPE (add 1 (add <a> <b>)) 0)))
    )

    add
    (((1 1) 0) 0)
    (((0 1) 0) 1)
)
</script>

<script id="exmpl-bincompare" type="text/plain">
/*
    binary number comparison
*/

(
    (
        REWRITE
        
        // both numbers single digits
        (              (REWRITE (ITYPE compare       0       0) (OTYPE                   eq)))
        (              (REWRITE (ITYPE compare       0       1) (OTYPE                   lt)))
        (              (REWRITE (ITYPE compare       1       0) (OTYPE                   gt)))
        (              (REWRITE (ITYPE compare       1       1) (OTYPE                   eq)))
        
        // first number multiple digits, second number single digit
        (    (VAR <a>) (REWRITE (ITYPE compare (<a> 0)       0) (OTYPE (compare <a>   0) eq)))
        (    (VAR <a>) (REWRITE (ITYPE compare (<a> 0)       1) (OTYPE (compare <a>   0) lt)))
        (    (VAR <a>) (REWRITE (ITYPE compare (<a> 1)       0) (OTYPE (compare <a>   0) gt)))
        (    (VAR <a>) (REWRITE (ITYPE compare (<a> 1)       1) (OTYPE (compare <a>   0) eq)))
        
        // first number single digit, second number multiple digits
        (    (VAR <b>) (REWRITE (ITYPE compare       0 (<b> 0)) (OTYPE (compare   0 <b>) eq)))
        (    (VAR <b>) (REWRITE (ITYPE compare       0 (<b> 1)) (OTYPE (compare   0 <b>) lt)))
        (    (VAR <b>) (REWRITE (ITYPE compare       1 (<b> 0)) (OTYPE (compare   0 <b>) gt)))
        (    (VAR <b>) (REWRITE (ITYPE compare       1 (<b> 1)) (OTYPE (compare   0 <b>) eq)))
        
        // both numbers multiple digits
        ((VAR <a> <b>) (REWRITE (ITYPE compare (<a> 0) (<b> 0)) (OTYPE (compare <a> <b>) eq)))
        ((VAR <a> <b>) (REWRITE (ITYPE compare (<a> 0) (<b> 1)) (OTYPE (compare <a> <b>) lt)))
        ((VAR <a> <b>) (REWRITE (ITYPE compare (<a> 1) (<b> 0)) (OTYPE (compare <a> <b>) gt)))
        ((VAR <a> <b>) (REWRITE (ITYPE compare (<a> 1) (<b> 1)) (OTYPE (compare <a> <b>) eq)))
        
        // reduce to final value
        ((VAR <x>) (REWRITE (ITYPE gt <x>) (OTYPE gt )))
        ((VAR <x>) (REWRITE (ITYPE lt <x>) (OTYPE lt )))
        ((VAR <x>) (REWRITE (ITYPE eq <x>) (OTYPE <x>)))
    )

    compare
    (((1 1) 0) 1)
    (((0 1) 0) 1)
)
</script>

<style type="text/css" media="screen">
    /*
    @font-face {
        font-family: 'Fira';
        src: url('FiraCode-Regular.ttf');
    }
    */
    
    html, body
    {
        height: 100%;
        width: 100%;
        margin-top: 0px;
        margin-left: 0px;
        background-color: white;
    }
    
    body {
        overflow: hidden;
    }

    #RLset1 {
        position:relative;
        width: 100%;
        height: 100%;
    }
    #input1 {
        position: relative;
        width: 100%;
        height: 100%;
        display: block;
    }
    #output1 {
        position: relative;
        width: 100%;
        height: 100%;
        display: block;
    }
    #nodes1 {
        position: relative;
        width: 100%;
        height: 100%;
        display: block;
    }
    
    #title  {color: #555555;}
    #foot   {color: #000000;}
    #all    {border-radius: 15px; border-spacing: 0px; border:0px solid #555555; color:#EEEEEE; background-color:#555555;}
    #top    {border-radius: 15px 15px 0px 0px; border-spacing: 0px; border:0px; color:#EEEEEE; background-color:#555555;}
    #bot    {border-radius: 0px 0px 15px 15px; border-spacing: 0px; border:0px; color:#EEEEEE; background-color:#555555;}
    #none   {border-radius: 0px 0px 0px 0px; color:#EEEEEE; background-color:#555555;}
    #in     {border:1px solid #555555; border-spacing: 0px; color:#EEEEEE; background-color:gray;}
    #dark   {border-spacing: 0px; border-left: 1px solid #4466DD; border-right: 1px solid #4466DD; border-bottom: 1px solid #4466DD; color:#DDEEFF; background-color:#334488;}

    a.exHover:visited, a.exHover:link {cursor: pointer; background-color: #333333; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    a.exHover:hover {cursor: pointer; background-color: #999999; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    a.exHover:active {cursor: pointer; background-color: #DDDDDD; color:#FFFFFF; text-decoration:none; border-radius: 15px;}
    a {text-align: center;}

    .dropbtn:visited {cursor: pointer; background-color: #333333; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    .dropbtn:link {cursor: pointer; background-color: #333333; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    .dropbtn:hover {cursor: pointer; background-color: #999999; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    .dropbtn:active {cursor: pointer; background-color: #DDDDDD; color:#FFFFFF; text-decoration:none; border-radius: 15px;}
    .dropbtn {
      text-align: left;
    }

    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      border-radius: 15px;
      display: block;
      /*position: absolute;*/
      background-color: #555555;
      width: 320px;
      overflow: auto;
      z-index: 65525;
      font-size: 0.8em;
      height: 100%;
    }

    .dropdown-content a {
      text-align: left;
      color: #FFFFFF;
      padding: 2px 4px;
      text-decoration: none;
      display: block;
    }

    .dropdown-content div {
      text-align: left;
      color: #BBBBBB;
      padding: 8px 8px;
      text-decoration: none;
      display: block;
    }

    
    .dropdown-content a:hover {background-color: #999999;}
    .dropdown-content a:active {cursor: pointer; background-color: #DDDDDD; color:#FFFFFF; text-decoration:none;}
    
    .show {display: block;}

    red {filter: grayscale(100%) contrast(1) brightness(0.75) url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><filter id='f'><feColorMatrix color-interpolation-filters='sRGB' type='matrix' values='1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0'/></filter></svg>#f");}
    grn {filter: grayscale(100%) contrast(1) brightness(0.75) url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><filter id='f'><feColorMatrix color-interpolation-filters='sRGB' type='matrix' values='0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0'/></filter></svg>#f");}
    blu {filter: grayscale(100%) contrast(1) brightness(0.75) url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><filter id='f'><feColorMatrix color-interpolation-filters='sRGB' type='matrix' values='0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0'/></filter></svg>#f");}

mark {
  color: 0;/*transparent;*/
  background-color: rgb(75,75,75);/*#d4e9ab; /* or whatever */
}

</style>
</head>
<body style="font-family: Arial, Helvetica, sans-serif;">
<table width="100%" height="100%" align="center" valign="middle" cellspacing="0" cellpadding="0" border="10px" style="border: 10px solid white;">
<tbody>
<tr>
<td class="exRound" id="top" cellpadding="10" align="center" valign="middle" height="30">
<font size="5"><strong>reasoner.js playground (work in progress)</strong></font>
</td>
</tr>
<tr>
<td id="in">
    <table width="100%" cellspacing="0" cellpadding="0" height="100%" border="0">
        <tbody><tr height="100%">
        <td width="0%" style="padding: 10px; padding-right:0;" >
    <div class="dropdown-content" width="100%" height="100%">
        <b><nobr>
        <!--div class="droplbl"><hr/>initial test</div>
        <a href="javascript:populate1('example0');">&nbsp;&nbsp;&nbsp; hearing voices</a>

        <div class="droplbl"><hr/>basic</div>
        <a href="javascript:populate1('example1-1');">&nbsp;&nbsp;&nbsp; <red>❎</red> hello world 1</a>
        <a href="javascript:populate1('example2a');">&nbsp;&nbsp;&nbsp; <grn>✅</grn> conversation decision</a>
        <a href="javascript:populate1('example3ze');">&nbsp;&nbsp;&nbsp; <grn>✅</grn> gravity decision</a>
        <a href="javascript:populate1('example3ae');">&nbsp;&nbsp;&nbsp; <grn>✅</grn> job title decision</a>
        <a href="javascript:populate1('example3be');">&nbsp;&nbsp;&nbsp; <grn>✅</grn> student decision</a>
        <a href="javascript:populate1('example3ce');">&nbsp;&nbsp;&nbsp; <grn>✅</grn> computer expert decision</a-->
        
<!--red>❎</red><grn>✅</grn><blu>🟩</blu-->

<div style="padding-bottom: 0px;"><font size="5"><strong>1. basic</strong></font></div>

<div style="padding-bottom: 0px;"><font size="4"><hr/>&nbsp;&nbsp;<strong>1.1. rules</strong></font></div>
<div class="droplbl"><hr/>&nbsp;&nbsp;&nbsp;&nbsp; 1.1.1. constants</div>
        <a href="javascript:populate1('example1-1');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <grn>✅</grn> hello world</a>
        <div class="droplbl"><hr/>&nbsp;&nbsp;&nbsp;&nbsp; 1.1.2. variables</div>
        <a href="javascript:populate1('example1-2');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <grn>✅</grn> hello entity</a>

<div style="padding-bottom: 0px;"><font size="4"><hr/>&nbsp;&nbsp;<strong>1.2. typed rewrite systems</strong></font></div>
<div class="droplbl"><hr/>&nbsp;&nbsp;&nbsp;&nbsp; 1.2.1. constants</div>
        <a href="javascript:populate1('example-2-1');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <grn>✅</grn> toy making decision</a>
        <a href="javascript:populate1('example-2-2');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <grn>✅</grn> shadows decision</a>
        
<div class="droplbl"><hr/>&nbsp;&nbsp;&nbsp;&nbsp; 1.2.2. variables</div>
        <a href="javascript:populate1('example-3-2');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <grn>✅</grn> job title decision</a>
        <a href="javascript:populate1('example-3-1');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <grn>✅</grn> weighting decision</a>

<div class="droplbl"><hr/>&nbsp;&nbsp;&nbsp;&nbsp; 1.2.3. higher order rules</div>
        <a href="javascript:populate1('example-4-1');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <red>❎</red> student decision</a>
        <a href="javascript:populate1('example-4-2');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <red>❎</red> computer expert decision</a>

<div style="padding-bottom: 0px;"><font size="5"><hr/><strong>2. intermediate</strong></font></div>
        <a href="javascript:populate1('example-5-1');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <red>❎</red> equality predicate</a>
        <a href="javascript:populate1('example-5-2');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <red>❎</red> branching choice</a>
        <a href="javascript:populate1('example-5-3');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <red>❎</red> Boolean calculator</a>
<!--br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <blu>🟩</blu> equality predicate...
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <blu>🟩</blu> branching choice...
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <blu>🟩</blu> Boolean calculator...-->

<div style="padding-bottom: 0px;"><font size="5"><hr/><strong>3. advanced</strong></font></div>
<div class="droplbl"><font size="4"><strong><hr/>&nbsp;&nbsp; 3.1. program execution</strong></font></div>
        <a href="javascript:populate1('example-7-1');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <red>❎</red> combinatory logic</a>
<div class="droplbl"><font size="4"><strong><hr/>&nbsp;&nbsp; 3.2. program compiling</strong></font></div>
        <a href="javascript:populate1('example-7-2');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <red>❎</red> lambda calculus to combinatory logic</a>
<div class="droplbl"><font size="4"><strong><hr/>&nbsp;&nbsp; 3.3. program analysis</strong></font></div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <blu>🟩</blu> lambda cube...
<br/><br/>
        <!--a href="javascript:populate1('example7');">&nbsp;&nbsp;&nbsp; <blu>🟩</blu> lambda calculus</a>
        <a href="javascript:populate1('example8');">&nbsp;&nbsp;&nbsp; <blu>🟩</blu> propositional logic</a>
        <!--a href="javascript:populate1('');">&nbsp;&nbsp;&nbsp; <blu>🟩</blu> set theory</a-->

        <!--div class="droplbl"><hr/>miscellaneous</div>
        <a href="javascript:populate('exmpl-binadd');">&nbsp;&nbsp;&nbsp; binary number addition</a>
        <a href="javascript:populate('exmpl-bincompare');">&nbsp;&nbsp;&nbsp; binary number comparison</a>
        <a href="javascript:populate('exmpl-meta1');">&nbsp;&nbsp;&nbsp; meta-rules</a-->
        </nobr></b>
    </div>
        </td>
        <td width="100%">
        <table width="100%" cellspacing="10" cellpadding="0" height="100%" border="0">
        <tbody>
        <tr height="100%">
        <td width="50%"">
            <table width="100%" cellspacing="0" cellpadding="0" height="100%" border="0">
            <tbody><tr>
             <td class="exRound" id="top" valign="middle" height="30" width="100%">
                <font size="2">
                <b>
<div class="dropdown">
                  &nbsp; &nbsp; rules: &nbsp;
                  <!--a id="mdd" onclick="myFunction()" href="javascript:void(null);" class="dropbtn">
                    &nbsp; examples &nbsp;
                  </a--> &nbsp;
    <!--div id="myDropdown" class="dropdown-content">
        <div class="droplbl"><hr/>initial test</div>
        <a href="javascript:populate1('example0');">&nbsp;&nbsp;&nbsp; hearing voices</a>

        <div class="droplbl"><hr/>intro</div>
        <a href="javascript:populate1('example1-1');">&nbsp;&nbsp;&nbsp; hello world 1</a>
        <a href="javascript:populate1('example1-2');">&nbsp;&nbsp;&nbsp; hello world 2</a>
        <a href="javascript:populate1('example2e');">&nbsp;&nbsp;&nbsp; conversation decision</a>
        <a href="javascript:populate1('example3e');">&nbsp;&nbsp;&nbsp; make toy decision</a>
        
        <div class="droplbl"><hr/>basic - extensional reasoning</div>
        <a href="javascript:populate1('example4e');">&nbsp;&nbsp;&nbsp; job title decision</a>
        <a href="javascript:populate1('example5e');">&nbsp;&nbsp;&nbsp; student decision</a>
        <a href="javascript:populate1('example6e');">&nbsp;&nbsp;&nbsp; computer expert decision</a>

        <div class="droplbl"><hr/>intermediate - intensional reasoning</div>
        <a href="javascript:populate1('example4i');">&nbsp;&nbsp;&nbsp; job title decision</a>
        <a href="javascript:populate1('example5i');">&nbsp;&nbsp;&nbsp; student decision</a>
        <a href="javascript:populate1('example6i');">&nbsp;&nbsp;&nbsp; computer expert decision</a>
        
        <div class="droplbl"><hr/>advanced</div>
        <a href="javascript:populate1('example7');">&nbsp;&nbsp;&nbsp; lambda calculus</a>

    </div-->
</div>
                </b>
                </font>
             </td>
            </tr>
            <tr height="100%">
             <!-- style="margin-top:-8px;"-->
             <td class="exRound" id="in" valign="top" style="" width="100%">
                <div id="rules" class="container"  width="100%" style="position: relative; width: 100%; height: 100%;">
                </div>
                <script>
                    var options = {
                        font: "9pt monospace",
                        tabWidth: 4,
                        colorText: "rgb(208,208,208)",
                        colorTextBack: "black",
                        colorSelection: "white",
                        colorSelectionBack: "gray",
                        colorKeyword: "rgb(104,104,104)",
                        colorKeywordBack: "transparent",
                        colorBracketMatch: "white",
                        colorBracketMatchBack: "rgb(75,75,75)",
                        colorStringAndComment: "rgb(104,104,104)",
                        keywords: ["\\bREWRITE\\b|\\bITYPE\\b|\\bIOCHAIN\\b|\\bOTYPE\\b|\\bMATCH\\b|\\bVAR\\b|\\bRULE\\b|\\bREAD\\b|\\bWRITE"], //["(?<=((\\(\\0x0000(\\s)*)|(\\((\\s)*)))(?!(\\0x0000|\\())([^\\s\\(\\)])+(?=(\\s|\\(|\\)|$))"],
                        stringsAndComments: "(/(?!\\*)(?!\\/)([^/\\\\\\n]|(\\\\.))*((/i)|(/)|(\\n)|($)))|(\"([^\"\\\\\\n]|(\\\\.))*((\")|(\\n)|($)))|(\\/\\/((.*\\n)|(.*$)))|(\\/\\*[\\S\\s]*?((\\*\\/)|$))"
                    }
                    var rules1 = edit ("rules", options);

                    document.addEventListener('selectionchange', function(e) {
                        var pos = getCoords(rules1.getValue(), rules1.getSelectionStart());
                        document.getElementById('lblGrammarCaret').innerHTML = "(" + pos.row + ", " + pos.column + ")&nbsp;";
                    });                    
                </script>
             </td>
            </tr>
            <tr>
              <td class="exRound" id="bot" height="5" align="right">
               <font size="1">
                <label id="lblGrammarCaret">(1, 1)</label>&nbsp;&nbsp;&nbsp;
               </font>
              </td>
            </tr>
            </tbody></table>
        </td>
        <td width="50%" height="100%">
            <table width="100%" cellspacing="0" cellpadding="0" height="50%" border="0" style="padding-bottom: 5px;">
            <tbody><tr>
             <td class="exRound" id="top" valign="middle" height="30">
                <font size="2">
                <b>
                  &nbsp; &nbsp; input: &nbsp; &nbsp;
                </b>
                </font>
             </td>
            </tr>
            <tr height="100%">
             <td class="exRound" id="in" style="border-radius: 0px 0px 0px 0px;">
                <div id="input" class="container" style="position: relative; width: 100%; height: 100%;">
                </div>
                <script>
                    var options = {
                        font: "9pt monospace",
                        tabWidth: 4,
                        colorText: "rgb(208,208,208)",
                        colorTextBack: "black",
                        colorSelection: "white",
                        colorSelectionBack: "gray",
                        colorKeyword: "rgb(104,104,104)",
                        colorKeywordBack: "transparent",
                        colorBracketMatch: "white",
                        colorBracketMatchBack: "rgb(75,75,75)",
                        colorStringAndComment: "rgb(104,104,104)",
                        keywords: ["failure"],//["(?<=((\\(\\0x0000(\\s)*)|(\\((\\s)*)))(?!(\\0x0000|\\())[^\\s\\(\\)]+(?=(\\s|\\(|\\)|$))"],
                        stringsAndComments: "(/(?!\\*)(?!\\/)([^/\\\\\\n]|(\\\\.))*((/i)|(/)|(\\n)|($)))|(\"([^\"\\\\\\n]|(\\\\.))*((\")|(\\n)|($)))|(\\/\\/((.*\\n)|(.*$)))|(\\/\\*[\\S\\s]*?((\\*\\/)|$))"
                    }
                    var input1 = edit ("input", options);

                    document.addEventListener('selectionchange', function(e) {
                        var pos = getCoords(input1.getValue(), input1.getSelectionStart());
                        document.getElementById('lblGrammarCaret1').innerHTML = "(" + pos.row + ", " + pos.column + ")&nbsp;";
                    });                    
                </script>
             </td>
            </tr>
            <tr>
              <td class="exRound" id="bot" height="5" align="right">
               <font size="1">
                <label id="lblGrammarCaret1">(1, 1)</label>&nbsp;&nbsp;&nbsp;
               </font>
              </td>
            </tr>
            </tbody></table>
            <table width="100%" cellspacing="0" cellpadding="0" height="50%" border="0" style="padding-top: 5px;">
            <tbody><tr>
             <td class="exRound" id="top" valign="middle" height="30">
                <font size="2">
                <b>
                  &nbsp; &nbsp; <!--output: &nbsp;-->
                  <a onclick="process()" class="exHover" href="javascript:void(null);">
                    &nbsp; process &nbsp;
                  </a> &nbsp;
                </b>
                </font>
             </td>
            </tr>
            <tr height="100%">
             <td class="exRound" id="in" style="border-radius: 0px 0px 15px 15px;">
              <textarea id="output" readonly wrap="off" spellcheck="false" id="output" style="outline: none; box-sizing: border-box; width: 100%; height:100%; resize: none; display: block; border-style: none; background-color: black; color: white; font: 9pt monospace; border-radius: 0px 0px 14px 14px; margin: 0; padding:5px;"></textarea>
                <script>
                    output1 = document.getElementById('output');
                </script>
             </td>
            </tr>
            </tbody></table>
        </td>
        </tr>
        </tbody>
        </table>
        </tr>
    </tbody></table>
</td>
</tr>
<tr>
 <td id="bot" valign="middle" height="30">
    <table width="100%" height="100%">
    <tr>
        <td align="left">
            <!--font size="2">
                &nbsp; &nbsp;
            </font-->
        </td>
        <td align="right">
            <font size="3">
              <b>
                <a class="exHover" href="https://github.com/mind-child/reasoner.js" target="new">
                &nbsp; visit me on GitHub &nbsp;
                </a>
                &nbsp; &nbsp;
              </b>
            </font>
        </td>
    </tr>
    </table>
 </td>
</tr>
</tbody>
</table>

<script>
    /* When the user clicks on the button, 
    toggle between hiding and showing the dropdown content */
    function myFunction() {
      document.getElementById("myDropdown").draggable = false;
      document.getElementById("myDropdown").ondragstart = function () {return false};
            
      document.getElementById("myDropdown").style.left = document.getElementById("mdd").offsetLeft + "px";
      document.getElementById("myDropdown").style.top = document.getElementById("mdd").offsetTop + document.getElementById("mdd").offsetHeight + 3 + "px";
      
      document.getElementById("myDropdown").classList.toggle("show");
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
      if (!event.target.matches('.dropbtn') && !event.target.matches('.droplbl')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
    
    function getCoords (text, offset) {
        var i, ch, row = 1, col = 1;
        if (text.length > 0)
            for (i = 0; i < offset; i += 1) {
                ch = text.charCodeAt(i);
                if (ch === 13 || ch === 10) {
                    if (ch === 13 && text.charCodeAt (i + 1) === 10)
                        i += 1;

                    row += 1;
                    col = 1;
                    
                } else
                  col += 1;
            }
        
        return {row: row, column: col};
    }

    function onkd () {
        var c = getCoords (input1.getValue (), input1.getSelectionStart ())
        document.getElementById("lblGrammarCaret").innerHTML = "(" + c.row + ", " + c.column + ")";
    }
    
    function populate1 (param) {
        rules1.setValue (document.getElementById(param).innerHTML);
        if (document.getElementById(param + "-input"))
            input1.setValue (document.getElementById(param + "-input").innerHTML);
        else
            input1.setValue ("");
            
        output1.value = "";
        setTimeout(function() {
            rules1.setSelectionStart (0);
            rules1.setSelectionEnd (0);
            input1.setSelectionStart (0);
            input1.setSelectionEnd (0);
            output1.selectionStart = 0;
            output1.selectionEnd = 0;
            onkd ();
            input1.setFocus ();
        }, 0);
    }
    
    cr = String.fromCharCode(13);
    
    function stringify (node, indent) {
        var str = ""
        
        str += indent + "(\n";
        
        for (var i = 0; i < node.length; i++) {
            if (Array.isArray (node[i]))
                str += stringify (node[i], indent + "    ");
                
            else {
                var part
                if (node [i] === undefined)
                    part = "UNDEFINED";
                    
                else if (node [i] === null)
                    part = "()";
                    
                else
                    part = node[i].replaceAll("\n", "\\n");
                 
                 str += indent + "    " + part + "\n";
            }
        }
        
        str += indent + ")\n";
        
        return str;
    }
    
    function process () {
        output1.value = "";
        setTimeout (function (){
            var rules = Parser.parse (rules1.getValue ());
            if (rules.err) {
                var c = getCoords (rules1.getValue (), rules.pos)
                output1.value = "rules error: " + rules.err + " at " + "(" + c.row + ", " + c.column + ")";
            } else {
                var input = Parser.parse (input1.getValue ());
                if (input.err) {
                    var c = getCoords (input1.getValue (), input.pos)
                    output1.value = "Input error: " + input.err + " at " + "(" + c.row + ", " + c.column + ")";
                } else {
                    var output = Rewriter.rewrite (rules, input, "FWD");
                    //var output = Rewriter.prove (rules, input, "FWD");
                    if (output.err) {
                        output1.value = "Match error while reading input";// at: " + JSON.stringify (output.err.indexes);
                    } else {
                        var output = Rewriter.rewrite (rules, input, "BWD");
                        //var output = Rewriter.prove (rules, input, "BWD");
                        if (output.err) {
                            output1.value = "Match error while writing output";// at: " + JSON.stringify (output.err.indexes);
                        } else {
                            output1.value = "OUTPUT:\n";
                            output1.value += stringify (output.output, "");
                            
                            output1.value += "\nPROOF:\n";
                            output1.value += JSON.stringify (output.proof, null, 2);
                            output1.value += "\n\nRULES:\n";
                            output1.value += JSON.stringify (output.rules, null, 2);
                            
                        }
                    }
                }
            }
            output1.selectionStart = 0;
            output1.selectionEnd = 0;
        }, 0);
    }

    
    //input1.addEventListener("keyup", onkd, false);
    //input1.addEventListener("input", onkd, false);
    //input1.addEventListener("mousedown", onkd, false);
    //input1.addEventListener("mouseup", onkd, false);

    populate1 ('example1-1');
    //populate1 ('test0');
</script>

</body>
</html>

